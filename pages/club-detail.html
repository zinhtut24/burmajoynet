<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Community Hub | BurmaJoyNet</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <style>
        :root { --joy-purple: #4f46e5; --joy-bg: #f8fafc; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--joy-bg); color: #1e293b; }
        
        /* Navbar & Header */
        .navbar-brand span { color: var(--joy-purple); }
        .club-cover-wrapper { height: 380px; position: relative; background: #0f172a; overflow: hidden; }
        .club-cover-wrapper img { transition: 0.5s; filter: brightness(0.7); }
        
        /* Post Box */
        .upload-card { border: none; border-radius: 16px; background: white; }
        .post-input { border: none; background: #f1f5f9; border-radius: 12px; padding: 15px; font-size: 0.95rem; }
        .post-input:focus { background: #e2e8f0; box-shadow: none; }
        
        /* Custom Buttons */
        .btn-joy-primary { background: var(--joy-purple); color: white; border-radius: 10px; font-weight: 700; transition: 0.3s; padding: 10px 20px; border: none; }
        .btn-joy-primary:hover { background: #4338ca; transform: translateY(-2px); color: white; }
        .action-btn { color: #64748b; font-weight: 600; font-size: 0.85rem; padding: 8px 12px; border-radius: 8px; transition: 0.2s; border: none; background: none; }
        .action-btn:hover { background: #f1f5f9; color: var(--joy-purple); }

        /* Media Preview */
        #media-preview-container img, #media-preview-container video { 
            max-height: 300px; width: auto; border-radius: 10px; margin-top: 10px; 
        }

        footer { background: white; border-top: 1px solid #e2e8f0; margin-top: 50px; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg sticky-top bg-white border-bottom shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-800 fs-4" href="../index.html">Burma<span>JoyNet</span></a>
            <div class="ms-auto" id="user-area">
                </div>
        </div>
    </nav>

    <div class="club-cover-wrapper d-flex align-items-end">
        <img id="club-cover" src="" class="position-absolute w-100 h-100 object-fit-cover" alt="Cover">
        <div class="container position-relative pb-5 text-white">
            <span id="club-category" class="badge bg-primary mb-3 rounded-pill px-3 py-2">Category</span>
            <h1 id="club-name-display" class="fw-800 display-3 mb-2">Loading...</h1>
            <div class="d-flex align-items-center gap-3">
                <span><i class="bi bi-people-fill me-2"></i><span id="member-count">0</span> Members</span>
                <span class="opacity-50">|</span>
                <span><i class="bi bi-patch-check-fill text-info me-1"></i> Verified Community</span>
            </div>
        </div>
    </div>

    <main class="container py-5">
        <div class="row g-4">
            <div class="col-lg-4">
                <div class="card upload-card shadow-sm p-4 mb-4">
                    <h5 class="fw-800 mb-3">Community Info</h5>
                    <p id="club-desc" class="text-muted small leading-relaxed">Loading details about this circle...</p>
                    <hr class="my-4 opacity-10">
                    <button id="join-btn" class="btn btn-joy-primary w-100" onclick="handleJoin()">Join Community</button>
                </div>

                <div class="card upload-card shadow-sm p-4 bg-white border-0">
                    <h6 class="fw-800 small text-uppercase text-muted mb-3">Community Rules</h6>
                    <div class="small">
                        <p class="mb-2"><i class="bi bi-shield-lock me-2 text-primary"></i> <b>Safe Space:</b> No hate speech allowed.</p>
                        <p class="mb-2"><i class="bi bi-lightning-charge me-2 text-warning"></i> <b>Stay Active:</b> Share your joy weekly.</p>
                        <p class="mb-0"><i class="bi bi-heart me-2 text-danger"></i> <b>Be Kind:</b> Support other creators.</p>
                    </div>
                </div>
            </div>

            <div class="col-lg-8">
                <div id="post-creator" class="card upload-card shadow-sm p-4 mb-4 d-none">
                    <div class="d-flex gap-3 mb-3">
                        <div id="user-initial" class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 48px; height: 48px; min-width: 48px;">U</div>
                        <textarea id="post-text" class="form-control post-input shadow-none" placeholder="Share a photo, video or a thought..." rows="2"></textarea>
                    </div>
                    
                    <div id="media-preview-container" class="mb-3"></div>

                    <div class="d-flex justify-content-between align-items-center border-top pt-3">
                        <div class="d-flex gap-1">
                            <button class="btn action-btn" onclick="document.getElementById('file-input').click()">
                                <i class="bi bi-camera-reels me-2 text-success"></i> Media
                            </button>
                            <input type="file" id="file-input" class="d-none" accept="image/*,video/*" onchange="previewMedia(event)">
                        </div>
                        <button class="btn btn-joy-primary px-4" onclick="createPost()">Post to Feed</button>
                    </div>
                </div>

                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="fw-800 mb-0">New to Feed</h5>
                    <select class="form-select form-select-sm border-0 bg-light shadow-none w-auto">
                        <option>Most Recent</option>
                        <option>Popular</option>
                    </select>
                </div>

                <div id="dynamic-posts">
                    <div class="card upload-card shadow-sm p-4 mb-3 border-0">
                        <p class="text-muted text-center my-4">No posts yet. Be the first to share something!</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="py-5">
        <div class="container text-center">
            <h4 class="fw-800 mb-4">Burma<span>JoyNet</span></h4>
            <div class="d-flex justify-content-center gap-4 mb-4">
                <a href="#" class="text-muted text-decoration-none small">About</a>
                <a href="#" class="text-muted text-decoration-none small">Guidelines</a>
                <a href="#" class="text-muted text-decoration-none small">Support</a>
            </div>
            <p class="text-muted x-small">© 2026 BurmaJoyNet Hub. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // ၁။ Global State
        let currentUser = localStorage.getItem('currentUser');
        let isJoined = false;

        // ၂။ Initialize Page & Auth
        function initPage() {
            // User UI Setup
            const userArea = document.getElementById('user-area');
            if (currentUser) {
                userArea.innerHTML = `
                    <div class="d-flex align-items-center gap-3">
                        <div class="text-end d-none d-md-block">
                            <h6 class="mb-0 fw-bold small">${currentUser}</h6>
                            <a href="javascript:void(0)" onclick="logout()" class="text-danger x-small text-decoration-none" style="font-size: 11px;">Sign Out</a>
                        </div>
                        <div class="bg-dark text-white rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 40px; height: 40px;">
                            ${currentUser.charAt(0).toUpperCase()}
                        </div>
                    </div>`;
                document.getElementById('user-initial').innerText = currentUser.charAt(0).toUpperCase();
            } else {
                userArea.innerHTML = `<a href="login.html" class="btn btn-joy-primary shadow-sm">Login / Register</a>`;
            }

            // Data Loading
            const params = new URLSearchParams(window.location.search);
            const clubName = params.get('name') || "Melody Seekers";
            const clubDetails = {
                "Melody Seekers": { cat: "Music", members: "1.5k", cover: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?auto=format&fit=crop&w=1200", desc: "For those who find joy in every note. Discuss, share and discover new music daily." },
                "Burma Pro Gamers": { cat: "Gaming", members: "3.8k", cover: "https://images.unsplash.com/photo-1542751371-adc38448a05e?auto=format&fit=crop&w=1200", desc: "Connect with the top players in Myanmar. Strategy, news, and daily tournaments." }
            };

            const data = clubDetails[clubName];
            if (data) {
                document.getElementById('club-name-display').innerText = clubName;
                document.getElementById('club-category').innerText = data.cat;
                document.getElementById('member-count').innerText = data.members;
                document.getElementById('club-desc').innerText = data.desc;
                document.getElementById('club-cover').src = data.cover;
            }
        }

        // ၃။ Auth Actions
        function logout() {
            localStorage.removeItem('currentUser');
            window.location.reload();
        }

        function handleJoin() {
            if (!currentUser) {
                alert("You need to login first!");
                window.location.href = "login.html";
                return;
            }
            isJoined = true;
            document.getElementById('join-btn').innerText = "Joined ✓";
            document.getElementById('join-btn').className = "btn btn-success w-100 disabled";
            document.getElementById('post-creator').classList.remove('d-none');
        }

        // ၄။ Media Preview Logic
        function previewMedia(event) {
            const container = document.getElementById('media-preview-container');
            container.innerHTML = "";
            const file = event.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                if (file.type.startsWith('video/')) {
                    container.innerHTML = `<video src="${url}" controls class="w-100 shadow-sm"></video>`;
                } else {
                    container.innerHTML = `<img src="${url}" class="w-100 shadow-sm">`;
                }
            }
        }

        // ၅။ Create Post Logic
        function createPost() {
            const text = document.getElementById('post-text').value;
            const fileInput = document.getElementById('file-input');
            const feed = document.getElementById('dynamic-posts');

            if (!text && !fileInput.files[0]) return;

            let mediaHTML = "";
            if (fileInput.files[0]) {
                const url = URL.createObjectURL(fileInput.files[0]);
                mediaHTML = fileInput.files[0].type.startsWith('video/') 
                    ? `<video src="${url}" controls class="w-100 rounded-3 mt-3 shadow-sm"></video>` 
                    : `<img src="${url}" class="w-100 rounded-3 mt-3 shadow-sm">`;
            }

            const postHTML = `
                <div class="card upload-card shadow-sm p-4 mb-3 border-0">
                    <div class="d-flex align-items-center gap-3 mb-3">
                        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 40px; height: 40px;">
                            ${currentUser.charAt(0).toUpperCase()}
                        </div>
                        <div>
                            <h6 class="mb-0 fw-bold small">${currentUser}</h6>
                            <small class="text-muted x-small">Just now • <i class="bi bi-globe"></i></small>
                        </div>
                    </div>
                    <p class="mb-0 small text-dark">${text}</p>
                    ${mediaHTML}
                    <div class="d-flex gap-4 border-top pt-3 mt-3">
                        <button class="btn btn-link text-muted text-decoration-none small p-0 fw-bold"><i class="bi bi-heart me-1"></i> Like</button>
                        <button class="btn btn-link text-muted text-decoration-none small p-0 fw-bold"><i class="bi bi-chat-left-text me-1"></i> Comment</button>
                    </div>
                </div>`;

            if (feed.innerHTML.includes('No posts yet')) feed.innerHTML = "";
            feed.insertAdjacentHTML('afterbegin', postHTML);
            
            // Reset Form
            document.getElementById('post-text').value = "";
            document.getElementById('file-input').value = "";
            document.getElementById('media-preview-container').innerHTML = "";
        }

        window.onload = initPage;
    </script>
</body>
</html>